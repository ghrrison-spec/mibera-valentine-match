{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://loa.dev/schemas/prd.schema.json",
  "title": "Product Requirements Document",
  "description": "JSON Schema for validating Loa PRD output structure",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the PRD (e.g., 1.0.0)"
    },
    "status": {
      "type": "string",
      "enum": ["Draft", "Review", "Approved", "Archived"],
      "description": "Current status of the PRD"
    },
    "date": {
      "type": "string",
      "format": "date",
      "description": "Date of last update (YYYY-MM-DD)"
    },
    "author": {
      "type": "string",
      "minLength": 1,
      "description": "Author or agent that created the PRD"
    },
    "problem_statement": {
      "type": "string",
      "minLength": 100,
      "description": "Clear description of the problem being solved (minimum 100 characters)"
    },
    "vision": {
      "type": "string",
      "minLength": 50,
      "description": "Product vision statement"
    },
    "goals": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^G-\\d+$",
            "description": "Goal identifier (e.g., G-1)"
          },
          "description": {
            "type": "string",
            "minLength": 10,
            "description": "Goal description"
          },
          "success_criteria": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Measurable success criteria"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"],
            "description": "Priority level"
          }
        },
        "required": ["description"]
      },
      "description": "Business and product goals"
    },
    "users": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "persona": {
            "type": "string",
            "description": "User persona name"
          },
          "description": {
            "type": "string",
            "description": "Persona description"
          },
          "needs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "User needs"
          },
          "pain_points": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Current pain points"
          }
        },
        "required": ["persona"]
      },
      "description": "Target users and personas"
    },
    "functional_requirements": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^FR-\\d+$",
            "description": "Requirement identifier (e.g., FR-1)"
          },
          "title": {
            "type": "string",
            "description": "Requirement title"
          },
          "description": {
            "type": "string",
            "description": "Detailed requirement description"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"],
            "description": "Priority level"
          },
          "acceptance_criteria": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Acceptance criteria for this requirement"
          }
        },
        "required": ["title", "description"]
      },
      "description": "Functional requirements"
    },
    "non_functional_requirements": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^NFR-\\d+$",
            "description": "Requirement identifier (e.g., NFR-1)"
          },
          "category": {
            "type": "string",
            "enum": ["Performance", "Security", "Scalability", "Reliability", "Usability", "Maintainability", "Compliance"],
            "description": "NFR category"
          },
          "title": {
            "type": "string",
            "description": "Requirement title"
          },
          "description": {
            "type": "string",
            "description": "Detailed requirement description"
          },
          "target": {
            "type": "string",
            "description": "Target metric or threshold"
          }
        },
        "required": ["category", "description"]
      },
      "description": "Non-functional requirements"
    },
    "user_stories": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^US-\\d+$",
            "description": "User story identifier (e.g., US-1)"
          },
          "persona": {
            "type": "string",
            "description": "User persona"
          },
          "story": {
            "type": "string",
            "description": "User story in 'As a... I want... So that...' format"
          },
          "acceptance_criteria": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Acceptance criteria"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"]
          }
        },
        "required": ["story"]
      },
      "description": "User stories"
    },
    "scope": {
      "type": "object",
      "properties": {
        "in_scope": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "What is included in this release"
        },
        "out_of_scope": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "What is explicitly excluded"
        },
        "future_considerations": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Items for future releases"
        }
      },
      "description": "Scope definition"
    },
    "risks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^R-\\d+$",
            "description": "Risk identifier (e.g., R-1)"
          },
          "description": {
            "type": "string",
            "description": "Risk description"
          },
          "impact": {
            "type": "string",
            "enum": ["Low", "Medium", "High", "Critical"],
            "description": "Impact level"
          },
          "probability": {
            "type": "string",
            "enum": ["Low", "Medium", "High"],
            "description": "Probability of occurrence"
          },
          "mitigation": {
            "type": "string",
            "description": "Mitigation strategy"
          }
        },
        "required": ["description"]
      },
      "description": "Identified risks"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Dependency name"
          },
          "type": {
            "type": "string",
            "enum": ["Technical", "External", "Resource", "Timeline"],
            "description": "Dependency type"
          },
          "description": {
            "type": "string",
            "description": "Dependency description"
          },
          "status": {
            "type": "string",
            "enum": ["Pending", "In Progress", "Resolved"],
            "description": "Current status"
          }
        },
        "required": ["name", "description"]
      },
      "description": "External and internal dependencies"
    },
    "timeline": {
      "type": "object",
      "properties": {
        "start_date": {
          "type": "string",
          "format": "date"
        },
        "target_date": {
          "type": "string",
          "format": "date"
        },
        "milestones": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "date": {
                "type": "string",
                "format": "date"
              },
              "deliverables": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "description": "Project timeline"
    },
    "sources": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "file": {
            "type": "string",
            "description": "Source file path"
          },
          "lines": {
            "type": "string",
            "description": "Line range (e.g., '12-30')"
          },
          "quote": {
            "type": "string",
            "description": "Relevant quote from source"
          }
        }
      },
      "description": "Source citations for traceability"
    }
  },
  "required": ["version", "status", "problem_statement", "goals"],
  "additionalProperties": true
}

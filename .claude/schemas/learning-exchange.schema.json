{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "learning-exchange.schema.json",
  "title": "Loa Learning Exchange Schema",
  "description": "Privacy-safe learning exchange format for federated upstream/downstream learning flow. All content must pass redaction before exchange.",
  "type": "object",
  "required": ["schema_version", "learning_id", "category", "title", "content", "quality_gates", "privacy", "redaction_report"],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "integer",
      "const": 1,
      "description": "Schema version for forward compatibility"
    },
    "learning_id": {
      "type": "string",
      "pattern": "^LX-[0-9]{8}-[a-f0-9]{8,12}$",
      "description": "Learning exchange ID (LX-YYYYMMDD-hexhash)"
    },
    "source_learning_id": {
      "type": "string",
      "description": "Original learning ID from source project (e.g., L-0001)"
    },
    "category": {
      "type": "string",
      "enum": ["pattern", "anti-pattern", "decision", "troubleshooting", "architecture", "security"],
      "description": "Category of the learning"
    },
    "title": {
      "type": "string",
      "minLength": 10,
      "maxLength": 200,
      "description": "Brief descriptive title"
    },
    "content": {
      "type": "object",
      "required": ["trigger", "solution"],
      "additionalProperties": false,
      "properties": {
        "context": {
          "type": "string",
          "maxLength": 500,
          "description": "When/where this learning applies (anonymized)"
        },
        "trigger": {
          "type": "string",
          "minLength": 10,
          "maxLength": 500,
          "description": "Conditions that indicate this learning applies"
        },
        "solution": {
          "type": "string",
          "minLength": 20,
          "maxLength": 2000,
          "description": "The pattern/solution discovered"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "maxItems": 10,
          "description": "Categorization tags"
        }
      }
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Confidence score (0.0-1.0)"
    },
    "quality_gates": {
      "type": "object",
      "required": ["depth", "reusability", "trigger_clarity", "verification"],
      "additionalProperties": false,
      "properties": {
        "depth": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "How deeply the learning was investigated"
        },
        "reusability": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "How applicable to other contexts"
        },
        "trigger_clarity": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "How clear the activation conditions are"
        },
        "verification": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "How well verified the solution is"
        }
      }
    },
    "privacy": {
      "type": "object",
      "required": ["contains_file_paths", "contains_secrets", "contains_pii"],
      "additionalProperties": false,
      "properties": {
        "contains_file_paths": {
          "type": "boolean",
          "const": false,
          "description": "Must be false — file paths must be redacted before exchange"
        },
        "contains_secrets": {
          "type": "boolean",
          "const": false,
          "description": "Must be false — secrets must be redacted before exchange"
        },
        "contains_pii": {
          "type": "boolean",
          "const": false,
          "description": "Must be false — PII must be redacted before exchange"
        }
      }
    },
    "redaction_report": {
      "type": "object",
      "required": ["rules_applied", "items_redacted", "items_blocked"],
      "additionalProperties": false,
      "properties": {
        "rules_applied": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of redaction rules that were applied"
        },
        "items_redacted": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of items that were redacted (replaced)"
        },
        "items_blocked": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of items blocked (must be 0 for valid exchange)"
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "source_framework_version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "effectiveness": {
          "type": "object",
          "properties": {
            "applications": {
              "type": "integer",
              "minimum": 0
            },
            "success_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        }
      }
    }
  }
}

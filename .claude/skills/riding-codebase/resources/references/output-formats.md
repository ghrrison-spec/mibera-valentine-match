# Output Format Templates

> Extracted from `riding-codebase` SKILL.md (Phases 6 and 6.5) for quick reference.

---

## Phase 6: Loa Artifact Generation (WITH GROUNDING MARKERS)

### Grounding Marker Reference

| Marker | When to Use | Example |
|--------|-------------|---------|
| `[GROUNDED]` | Direct code evidence | `[GROUNDED] Uses PostgreSQL (prisma/schema.prisma:L3)` |
| `[INFERRED]` | Logical deduction from multiple sources | `[INFERRED] Likely handles bulk operations based on batch naming` |
| `[ASSUMPTION]` | No direct evidence - needs validation | `[ASSUMPTION] OAuth was planned but descoped - verify with team` |

### 6.1 PRD Template

File: `grimoires/loa/prd.md`

```markdown
# Product Requirements Document

> **Source of Truth Notice**
> Generated from code analysis on [date].
> All claims use grounding markers: [GROUNDED], [INFERRED], [ASSUMPTION]

## Document Metadata
| Field | Value |
|-------|-------|
| Generated | [timestamp] |
| Source | Code reality extraction |
| Drift Score | X% |
| Grounding | X% GROUNDED, Y% INFERRED, Z% ASSUMPTION |

## User Types
[From actual role/permission code with evidence]

### User Type: [Name]
- **[GROUNDED]** Role exists in `src/auth/roles.ts:23`
- **[GROUNDED]** Permissions: [list from code with citations]

## Features (Code-Verified)

### Feature: [Name]
- **[GROUNDED]** Status: Active in code (`src/features/x/index.ts:1-50`)
- **[GROUNDED]** Endpoints: [from api-routes.txt with file:line]
- **[INFERRED]** Purpose: [deduced from function names and structure]

### Feature: [Documented but Uncertain]
- **[ASSUMPTION]** This feature was mentioned in docs but implementation unclear
- **Requires validation by**: Engineering Lead
```

### 6.2 SDD Template

File: `grimoires/loa/sdd.md`

```markdown
# System Design Document

> **Source of Truth Notice**
> Generated from code analysis on [date].
> All claims use grounding markers: [GROUNDED], [INFERRED], [ASSUMPTION]

## Architecture (As-Built)

### Tech Stack (Verified)
| Component | Technology | Grounding | Evidence |
|-----------|------------|-----------|----------|
| Runtime | Node.js | [GROUNDED] | `package.json:engines` |
| Database | PostgreSQL | [GROUNDED] | `DATABASE_URL` pattern in `.env.example:L5` |
| Cache | Redis | [INFERRED] | Redis imports found, config unclear |

### Module Structure
[From directory analysis with actual paths]
- **[GROUNDED]** `src/api/` - API handlers (47 files)
- **[GROUNDED]** `src/services/` - Business logic (23 files)
- **[INFERRED]** `src/utils/` - Shared utilities (likely internal)

### Data Model
[From data-models.txt with schema quotes]

#### Entity: [Name]
- **[GROUNDED]** Schema definition: `prisma/schema.prisma:L45-60`
- **[GROUNDED]** Fields: [list with evidence]
- **[ASSUMPTION]** Relationship to [OtherEntity] - schema suggests but unclear

### API Surface
| Method | Endpoint | Handler | Grounding |
|--------|----------|---------|-----------|
| GET | /api/users | UserController.list | [GROUNDED] `src/controllers/user.ts:L23` |
| POST | /api/auth | AuthController.login | [GROUNDED] `src/controllers/auth.ts:L45` |
```

### 6.3 Grounding Summary Block

Appended to the end of BOTH PRD and SDD:

```markdown
---

## Grounding Summary

| Category | Count | Percentage |
|----------|-------|------------|
| [GROUNDED] (direct evidence) | N | X% |
| [INFERRED] (logical deduction) | N | Y% |
| [ASSUMPTION] (needs validation) | N | Z% |
| **Total Claims** | N | 100% |

### Assumptions Requiring Validation

| # | Claim | Location | Validator Needed |
|---|-------|----------|------------------|
| 1 | [Assumption text] | prd.md:L[N] | [Role] |
| 2 | [Assumption text] | sdd.md:L[N] | [Role] |

> **Quality Target**: >80% GROUNDED, <10% ASSUMPTION
```

---

## Phase 6.5: Reality File Generation (Token-Optimized Codebase Interface)

### 6.5.0 Reality Directory Setup

```bash
mkdir -p grimoires/loa/reality
REALITY_DIR="grimoires/loa/reality"
TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)
COMMIT_HASH=$(git rev-parse --short HEAD 2>/dev/null || echo "unknown")
```

### 6.5.1 index.md (Hub File)

Target: < 500 tokens.

```markdown
# Reality Index

> Generated by /ride on [TIMESTAMP]
> Source commit: [COMMIT_HASH]

## Codebase Overview

| Property | Value |
|----------|-------|
| Language | [Primary language from package.json/go.mod/etc] |
| Framework | [Main framework if detected] |
| Entry Point | [Main entry file path] |
| Total Files | [Count from Phase 2] |
| Lines of Code | [Approximate from probe] |

## Navigation

| I want to... | Read | Tokens |
|--------------|------|--------|
| See public API functions | [api-surface.md](api-surface.md) | ~[N] |
| Understand data types | [types.md](types.md) | ~[N] |
| Learn integration patterns | [interfaces.md](interfaces.md) | ~[N] |
| Find entry points | [entry-points.md](entry-points.md) | ~[N] |
| See directory structure | [structure.md](structure.md) | ~[N] |

## Quick Reference

**Main entry**: `[path]:1`
**API routes**: `[routes file path]`
**Auth handler**: `[auth file if exists]`
```

### 6.5.2 api-surface.md (Public Functions)

Target: < 2000 tokens.

Setup:

```bash
# Extract exported functions and their signatures
echo "# API Surface" > "$REALITY_DIR/api-surface.md"
echo "" >> "$REALITY_DIR/api-surface.md"
echo "> Generated by /ride on $TIMESTAMP" >> "$REALITY_DIR/api-surface.md"
echo "" >> "$REALITY_DIR/api-surface.md"
```

Public functions per service/module:

```markdown
## Public Functions

### [ServiceName] (`[file path]`)

| Function | Signature | Line |
|----------|-----------|------|
| [name] | `[params] => [return type]` | [line number] |
```

API endpoints:

```markdown
## API Endpoints

| Method | Route | Handler | Line |
|--------|-------|---------|------|
| POST | /api/v1/users | UserController.create | [file:line] |
```

### 6.5.3 types.md (Type Definitions)

Target: < 2000 tokens.

```markdown
# Type Definitions

> Generated by /ride on [TIMESTAMP]

## Core Types

### [TypeName] (`[file path]:[line]`)

```typescript
[Type definition code]
```
```

Group by domain (User types, Payment types, etc.) for better organization.

### 6.5.4 interfaces.md (Integration Patterns)

Target: < 1000 tokens.

```markdown
# Integration Interfaces

> Generated by /ride on [TIMESTAMP]

## External Integrations

### [Integration Name]

**Location**: `[file path]:[line]`

```typescript
[Interface code]
```

**Required env vars**: `[VAR1]`, `[VAR2]`

## Webhooks

### [Webhook Name] (`[file path]:[line]`)

**Endpoint**: [METHOD] [path]
**Payload**:
```typescript
[Payload type definition]
```
```

### 6.5.5 structure.md (Directory Tree)

Target: < 1000 tokens.

```markdown
# Codebase Structure

> Generated by /ride on [TIMESTAMP]

## Directory Tree

```
src/
├── index.ts              # Application entry point
├── config/
│   ├── database.ts       # Database configuration
│   └── env.ts            # Environment validation
├── routes/
│   └── ...               # HTTP routing
├── services/
│   └── ...               # Business logic
└── types/
    └── ...               # Type definitions
```

## Module Responsibilities

| Module | Purpose | Dependencies |
|--------|---------|--------------|
| routes/ | HTTP routing | services/, middleware/ |
| services/ | Business logic | types/, utils/ |
```

### 6.5.6 entry-points.md (Starting Points)

Target: < 500 tokens.

```markdown
# Entry Points

> Generated by /ride on [TIMESTAMP]

## Application Entry

| Type | File | Line | Command |
|------|------|------|---------|
| Main | [main file] | 1 | `npm start` / `go run` |
| Dev | [same or different] | 1 | `npm run dev` |
| Test | [test setup] | 1 | `npm test` |

## API Routes

| Route Prefix | File | Description |
|--------------|------|-------------|
| /api/v1/users | [file] | User management |

## CLI Commands

| Command | File | Description |
|---------|------|-------------|
| [command] | [file] | [purpose] |

## Environment Requirements

| Variable | Required | Default |
|----------|----------|---------|
| [VAR] | Yes/No | [value or -] |
```

### 6.5.7 architecture-overview.md (Architecture Grounding)

Target: < 1500 tokens.

```markdown
# Architecture Overview

> Token-optimized architecture grounding for agent consumption.
> Generated by /ride on [TIMESTAMP] | Budget: <1500 tokens

## System Components

```
[ASCII component diagram derived from structure.md and api-routes.txt]
Example:
┌──────────┐     ┌──────────┐     ┌──────────┐
│  Client   │────▶│  API GW  │────▶│ Services │
└──────────┘     └──────────┘     └────┬─────┘
                                       │
                                 ┌─────▼─────┐
                                 │  Database  │
                                 └───────────┘
```

## Data Flow

1. [Primary request path: Client → [entry] → [handler] → [service] → [store]]
2. [Secondary paths: webhooks, background jobs, etc.]

## Technology Stack

| Layer | Technology | Evidence |
|-------|-----------|----------|
| Runtime | [tech] | [file:line] |
| Framework | [tech] | [file:line] |
| Database | [tech] | [file:line] |
| Cache | [tech] | [file:line] |

## Entry Points

| Entry | Path | Type |
|-------|------|------|
| [name] | [file path] | HTTP/CLI/Worker/Cron |
```

### 6.5.8 .reality-meta.json (Metadata)

```bash
# Count tokens (using word count as proxy)
INDEX_TOKENS=$(wc -w < "$REALITY_DIR/index.md" 2>/dev/null || echo 0)
API_TOKENS=$(wc -w < "$REALITY_DIR/api-surface.md" 2>/dev/null || echo 0)
TYPES_TOKENS=$(wc -w < "$REALITY_DIR/types.md" 2>/dev/null || echo 0)
INTERFACES_TOKENS=$(wc -w < "$REALITY_DIR/interfaces.md" 2>/dev/null || echo 0)
STRUCTURE_TOKENS=$(wc -w < "$REALITY_DIR/structure.md" 2>/dev/null || echo 0)
ENTRY_TOKENS=$(wc -w < "$REALITY_DIR/entry-points.md" 2>/dev/null || echo 0)
ARCH_TOKENS=$(wc -w < "$REALITY_DIR/architecture-overview.md" 2>/dev/null || echo 0)
TOTAL_TOKENS=$((INDEX_TOKENS + API_TOKENS + TYPES_TOKENS + INTERFACES_TOKENS + STRUCTURE_TOKENS + ENTRY_TOKENS + ARCH_TOKENS))
```

```json
{
  "generated_at": "$TIMESTAMP",
  "source_commit": "$COMMIT_HASH",
  "generator_version": "1.0.0",
  "token_counts": {
    "index": INDEX_TOKENS,
    "api-surface": API_TOKENS,
    "types": TYPES_TOKENS,
    "interfaces": INTERFACES_TOKENS,
    "structure": STRUCTURE_TOKENS,
    "entry-points": ENTRY_TOKENS,
    "architecture-overview": ARCH_TOKENS,
    "total": TOTAL_TOKENS
  },
  "staleness_threshold_days": 7
}
```

### 6.5.9 Token Budget Verification

```bash
# Verify token budgets
if [[ $INDEX_TOKENS -gt 500 ]]; then
  echo "WARNING: index.md exceeds 500 token budget ($INDEX_TOKENS tokens)"
fi
if [[ $ARCH_TOKENS -gt 1500 ]]; then
  echo "WARNING: architecture-overview.md exceeds 1500 token budget ($ARCH_TOKENS tokens)"
fi
if [[ $TOTAL_TOKENS -gt 8500 ]]; then
  echo "WARNING: Total reality files exceed 8500 token budget ($TOTAL_TOKENS tokens)"
fi

echo "Reality files generated in $REALITY_DIR"
echo "  Total tokens: $TOTAL_TOKENS (budget: 8500)"
```

### 6.5.10 Trajectory Log Entry

```json
{"timestamp": "...", "agent": "riding-codebase", "phase": "6.5", "action": "reality_generation", "details": {"files": 7, "total_tokens": N, "within_budget": true}}
```
